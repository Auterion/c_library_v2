<?xml version="1.0"?>
<mavlink>
  <include>common.xml</include>
  <!-- Note that custom messages should use the command id range from 150 to 250, to leave plenty of room for growth of common.xml If you prototype a message here, then you should consider if it is general enough to move into common.xml later -->
  <enums>
    <enum name="WINCH_CONTROL_MODE">
      <entry value="0" name="POSITION"/>
      <entry value="1" name="VELOCITY"/>
      <entry value="2" name="IDLE"/>
    </enum>
    <enum name="ODRIVE_STATES">
      <entry value="0" name="AXIS_STATE_UNDEFINED"/>
      <entry value="1" name="AXIS_STATE_IDLE"/>
      <entry value="2" name="AXIS_STATE_STARTUP_SEQUENCE"/>
      <entry value="3" name="AXIS_STATE_FULL_CALIBRATION_SEQUENCE"/>
      <entry value="4" name="AXIS_STATE_MOTOR_CALIBRATION"/>
      <entry value="5" name="AXIS_STATE_SENSORLESS_CONTROL"/>
      <entry value="6" name="AXIS_STATE_ENCODER_INDEX_SEARCH"/>
      <entry value="7" name="AXIS_STATE_ENCODER_OFFSET_CALIBRATION"/>
      <entry value="8" name="AXIS_STATE_CLOSED_LOOP_CONTROL"/>
      <entry value="9" name="AXIS_STATE_LOCKIN_SPIN"/>
      <entry value="10" name="AXIS_STATE_ENCODER_DIR_FIND"/>
      <entry value="11" name="AXIS_STATE_HOMING"/>
    </enum>
    <enum name="FAILURE_LEVEL">
      <entry value="0" name="NO_FAILURE"/>
      <entry value="1" name="PREVENT_PREFLIGHT"/>
      <entry value="2" name="MISSION_FAILURE"/>
      <entry value="3" name="FLIGHT_FAILURE"/>
    </enum>
  </enums>
  <messages>
    <message id="7001" name="CARRIER_GUIDANCE">
      <description>Message containing carrier guidance for use in the package controller</description>
      <field type="float" name="x" units="m">X Position in NED Frame</field>
      <field type="float" name="y" units="m">Y Position in NED Frame</field>
      <field type="float" name="z" units="m">Z Position in NED Frame</field>
      <field type="float" name="vx" units="m/s">X Velocity in NED Frame</field>
      <field type="float" name="vy" units="m/s">X Velocity in NED Frame</field>
      <field type="float" name="vz" units="m/s">X Velocity in NED Frame</field>
      <field type="float" name="ax" units="m/s^2">X Acceleration in NED Frame</field>
      <field type="float" name="ay" units="m/s^2">X Acceleration in NED Frame</field>
      <field type="float" name="az" units="m/s^2">X Acceleration in NED Frame</field>
    </message>
    <message id="7002" name="WINCH_DEBUG_DATA">
      <description>Collection of debug data fields for logging on the fmu</description>
      <field type="float" name="spool_x" units="m">Position of the winch motor (spool)</field>
      <field type="float" name="spool_v" units="m/s">Velocity of the winch motor (spool)</field>
      <field type="float" name="spool_x_setpoint" units="m">Commanded position of the winch motor (spool)</field>
      <field type="float" name="spool_v_setpoint" units="m/s">Commanded velocity of the winch motor (spool)</field>
      <field type="float" name="payout_x" units="m">Payout position of the winch encoder (roller)</field>
      <field type="float" name="payout_v" units="m/s">Payout velocity of the winch encoder (roller)</field>
      <field type="float" name="payout_x_setpoint" units="m">Commanded payout position of the winch encoder (roller)</field>
      <field type="float" name="payout_v_setpoint" units="m/s">Commanded payout velocity of the winch encoder (roller)</field>
      <field type="float" name="correction" units="m">Applied correction to the winch (from package.py)</field>
      <field type="float" name="datum" units="m">Zero datum for the winch (payout)</field>
      <field type="float" name="force" units="N">Line force on the winch (motor)</field>
      <field type="float" name="disparity" units="m">Disparity between spool and payout positions of the winch</field>
      <field type="uint8_t" name="mode" enum="WINCH_CONTROL_MODE">Winch control mode</field>
      <field type="float" name="current" units="A">Winch Current Draw</field>
      <field type="float" name="voltage" units="V">Winch Supply voltage</field>
      <field type="uint16_t" name="err" units="mask">Error code (see odrive docs to interpret)</field>
      <field type="uint16_t" name="motor_err" units="mask">Motor error code (see odrive docs to interpret)</field>
      <field type="uint16_t" name="encoder_err" units="mask">Encoder error code (see odrive docs to interpret)</field>
      <field type="uint16_t" name="state" enum="ODRIVE_STATES">Motor controller state</field>
    </message>
    <message id="7003" name="REACTION_WHEEL_TELEMETRY">
      <description>telemetry data for the reaction wheel on the package, if present.</description>
      <field type="float" name="velocity" units="rad/s">Velocity of the wheel</field>
      <field type="float" name="torque" units="Nm">Torque</field>
      <field type="float" name="current" units="A">Current</field>
      <field type="float" name="voltage" units="V">Voltage</field>
      <field type="uint16_t" name="err" units="mask">Error code (see odrive docs to interpret)</field>
      <field type="uint16_t" name="motor_err" units="mask">Motor error code (see odrive docs to interpret)</field>
      <field type="uint16_t" name="encoder_err" units="mask">Encoder error code (see odrive docs to interpret)</field>
      <field type="uint16_t" name="state" enum="ODRIVE_STATES">Motor controller state</field>
    </message>
    <message id="7004" name="ALARM_REPORT">
      <description>Alarm report including bitmask of all set alarms and all conclusions.</description>
      <field type="uint64_t[10]" name="alarm_mask" units="mask">Active alarm bitmask</field>
      <field type="uint8_t" name="failure_level" enum="FAILURE_LEVEL">An exception is currently blocking preflight</field>
    </message>
    <message id="7005" name="SET_ALARM">
      <description>Message to set/unset an alarm on the mission computer.</description>
      <field type="uint32_t" name="alarm_id" units="id">ID of the alarm to set/clear</field>
      <field type="uint8_t" name="set" units="boolean">True to set, False to clear</field>
    </message>
    <message id="7006" name="WIND_SENSOR_GROUND">
      <description>Message for ground-based trisonica sensor.</description>
      <field type="float" name="wind_n" units="m/s">Velocity of air w.r.t ground in north</field>
      <field type="float" name="wind_e" units="m/s">Velocity of air w.r.t ground in east</field>
      <field type="float" name="wind_d" units="m/s">Velocity of air w.r.t ground in down</field>
      <field type="float" name="temperature" units="C">Temperature</field>
      <field type="float" name="humidity" units="percent">Humidity</field>
      <field type="float" name="pressure" units="Pa">Pressure</field>
      <field type="float" name="wind_speed" units="m/s">Absolute lateral wind speed</field>
      <field type="float" name="wind_heading" units="deg">Heading from north about down</field>
    </message>
    <message id="7007" name="WIND_SENSOR_BODY">
      <description>Message for body-fixed wind sensor.</description>
      <field type="float" name="wind_n" units="m/s">Velocity of air w.r.t ground in north</field>
      <field type="float" name="wind_e" units="m/s">Velocity of air w.r.t ground in east</field>
      <field type="float" name="wind_d" units="m/s">Velocity of air w.r.t ground in down</field>
      <field type="float" name="temperature" units="C">Temperature</field>
      <field type="float" name="humidity" units="percent">Humidity</field>
      <field type="float" name="pressure" units="Pa">Pressure</field>
      <field type="float" name="wind_speed" units="m/s">Absolute lateral wind speed</field>
      <field type="float" name="wind_heading" units="deg">Heading from north about down</field>
    </message>
    <message id="7008" name="PACKAGE_COMMANDER_STATUS">
      <description>Package commander status, from package.py.</description>
      <field type="uint8_t" name="is_active" units="boolean"> Actively following a trajectory</field>
      <field type="uint8_t" name="on_ground" units="boolean"> On the ground</field>
      <field type="uint8_t" name="autoretract_allowed" units="boolean"> autoretract currently allowed by the trajectory</field>
      <field type="uint8_t" name="autoretract_enabed" units="boolean"> Mission node enabled autoretraction</field>
      <field type="uint64_t" name="autoretract_time_utc" units="ms"> Time when retract will be initialized. If nonzero.</field> 
      <field type="uint8_t" name="ready_for_autoretract" units="boolean"> Mission node enabled autoretraction</field>
      <field type="float" name="impact_pos_x" units="m/s">Position to retract from, x. (Trajectory can ignore)</field>
      <field type="float" name="impact_pos_y" units="m/s">Position to retract from, y. (Trajectory can ignore)</field>
      <field type="float" name="impact_pos_z" units="m/s">Position to retract from, z. (Trajectory can ignore)</field>
      <field type="float" name="target_impact_pos_x" units="m/s">Position to retract from, x. (Trajectory can ignore)</field>
      <field type="float" name="target_impact_pos_y" units="m/s">Position to retract from, y. (Trajectory can ignore)</field>
      <field type="float" name="target_impact_pos_z" units="m/s">Position to retract from, z. (Trajectory can ignore)</field>
      <field type="float" name="xy_error" units="m"> XY position error in meters.</field>
      <field type="float" name="z_error" units="m"> XY position error in meters.</field>
      <field type="float" name="xy_error_touchdown" units="m"> XY position error in meters at the touchdown moment</field>
      <field type="float" name="z_error_touchdown" units="m"> XY position error in meters at the touchdown moment</field>
    </message>
    <message id="7009" name="FILE_LOG_CHUNK">
      <description>Part of a logged file.</description>
      <field type="uint8_t[20]" name="filename" units="string">Name of the file, as a string. Not necessarily null terminated.</field>
      <field type="uint16_t" name="chunks" units="chunks">Number of chunks in this file.</field>
      <field type="uint16_t" name="chunk_index" units="chunks">Current chunk (zero-indexed.)</field>
      <field type="uint8_t" name="len" units="bytes">Number of bytes in this chunk. Should be max (200) unless this is the last chunk.</field>
      <field type="uint8_t[200]" name="data" units="binary">Data.</field>
    </message>
  </messages>
</mavlink>
